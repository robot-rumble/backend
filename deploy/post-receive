NAME="robot"
COMMAND="docker-compose -f $HOME/robot/docker-compose.prod.yml up --build -d"

TARGET="$HOME/$NAME"
GIT_DIR="$HOME/$NAME.git"
BRANCH="master"

set -e

while read oldrev newrev ref
do
        echo "Ref $ref received. Deploying $BRANCH branch to production..."

        mkdir -p $TARGET
        cd $TARGET
        git --work-tree=$TARGET --git-dir=$GIT_DIR checkout -f
        bash -c "$COMMAND"
done
